{"id":"f0ff6900-9fdc-4a02-a642-ca730cb2a194","name":"workflow-batch-credit-risk-scoring","description":"","settings":{"global":{"executionMode":"marathon","userPluginsJars":[],"preExecutionSqlSentences":[],"postExecutionSqlSentences":[],"addAllUploadedPlugins":true,"mesosConstraintOperator":"CLUSTER","parametersLists":["Environment"],"parametersUsed":["Global.SPARK_CORES_MAX","Global.SPARK_DRIVER_CORES","Global.SPARK_DRIVER_JAVA_OPTIONS","Global.SPARK_DRIVER_MEMORY","Global.SPARK_EXECUTOR_CORES","Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS","Global.SPARK_EXECUTOR_MEMORY","Global.SPARK_LOCALITY_WAIT","Global.SPARK_LOCAL_PATH","Global.SPARK_MEMORY_FRACTION","Global.SPARK_STREAMING_BLOCK_INTERVAL","Global.SPARK_STREAMING_CHECKPOINT_PATH","Global.SPARK_STREAMING_WINDOW","Global.SPARK_TASK_MAX_FAILURES"],"udfsToRegister":[],"udafsToRegister":[],"marathonDeploymentSettings":{"gracePeriodSeconds":"240","intervalSeconds":"20","timeoutSeconds":"20","maxConsecutiveFailures":"3","forcePullImage":true,"privileged":false,"userEnvVariables":[],"userLabels":[]},"enableQualityRules":true},"streamingSettings":{"window":"{{{Global.SPARK_STREAMING_WINDOW}}}","blockInterval":"{{{Global.SPARK_STREAMING_BLOCK_INTERVAL}}}","stopGracefully":true,"checkpointSettings":{"checkpointPath":"{{{Global.SPARK_STREAMING_CHECKPOINT_PATH}}}","enableCheckpointing":true,"autoDeleteCheckpoint":true,"addTimeToCheckpointPath":false}},"sparkSettings":{"master":"mesos://zk://master.mesos:2181/mesos","sparkKerberos":true,"sparkDataStoreTls":true,"sparkMesosSecurity":true,"submitArguments":{"userArguments":[],"deployMode":"client","driverJavaOptions":"{{{Global.SPARK_DRIVER_JAVA_OPTIONS}}}"},"sparkConf":{"sparkResourcesConf":{"coresMax":"{{{Global.SPARK_CORES_MAX}}}","executorMemory":"{{{Global.SPARK_EXECUTOR_MEMORY}}}","executorCores":"{{{Global.SPARK_EXECUTOR_CORES}}}","driverCores":"{{{Global.SPARK_DRIVER_CORES}}}","driverMemory":"{{{Global.SPARK_DRIVER_MEMORY}}}","localityWait":"{{{Global.SPARK_LOCALITY_WAIT}}}","taskMaxFailures":"{{{Global.SPARK_TASK_MAX_FAILURES}}}","sparkMemoryFraction":"{{{Global.SPARK_MEMORY_FRACTION}}}"},"sparkHistoryServerConf":{"enableHistoryServerMonitoring":false,"sparkHistoryServerEventLogRotateEnable":false,"sparkHistoryServerEventLogRotateNum":"9","sparkHistoryServerEventLogRotateSize":"512"},"userSparkConf":[],"coarse":true,"sparkLocalDir":"{{{Global.SPARK_LOCAL_PATH}}}","sparkSqlCaseSensitive":true,"hdfsTokenCache":true,"executorExtraJavaOptions":"{{{Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS}}}"}},"errorsManagement":{"genericErrorManagement":{"whenError":"Error"},"transformationStepsManagement":{"whenError":"Error","whenRowError":"RowError","whenFieldError":"FieldError"},"transactionsManagement":{"sendToOutputs":[],"sendStepData":false,"sendPredecessorsData":true,"sendInputData":true}}},"pipelineGraph":{"nodes":[{"name":"HighRiskFilter","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":1527.1777601591648,"y":641.1849762472947}},"configuration":{"filterExp":"ProbabilityValue < 0.8","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"CreditRequestsToday","stepType":"Input","className":"CrossdataInputStep","classPrettyName":"Crossdata","arity":["NullaryToNary"],"uiConfiguration":{"position":{"x":48.53860386941395,"y":489.34347939916677}},"configuration":{"crossdata":"{\"database\":\"default\",\"table\":\"client_credit_requests_today\"}","debugOptions":"{\"query\":\"SELECT * FROM default.client_credit_requests_today LIMIT 20\"}","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"MlModel","stepType":"Transformation","className":"MlModelTransformStep","classPrettyName":"MlModel","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":265.97998685374023,"y":489.34342046919124}},"configuration":{"selectMlType":"ML_MODEL_URL","model":"riskscoring-v07","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"ProcessedAndAuditoryDataJoined","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"Join of the data result from the MlModel (after transformations) and the External Auditory Data","uiConfiguration":{"position":{"x":884.6983551506236,"y":489.43045039924164}},"configuration":{"rightTable":"RenameColumns","leftTable":"ExternalAuditoryData","inputSchemas":"[]","joinConditions":[{"leftField":"ID","rightField":"ID_Ml"}],"errorTableName":"","joinType":"LEFT","joinReturn":"ALL"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"ExternalAuditoryData","stepType":"Input","className":"CrossdataInputStep","classPrettyName":"Crossdata","arity":["NullaryToNary"],"uiConfiguration":{"position":{"x":885.1390161496884,"y":343.27122089418316}},"configuration":{"crossdata":"{\"database\":\"default\",\"table\":\"client_external_info\"}","debugOptions":"{\"query\":\"SELECT * FROM default.client_external_info LIMIT 20\"}","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"MlFiltered","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"uiConfiguration":{"position":{"x":467.2864272071338,"y":489.2341789835955}},"configuration":{"sql":"SELECT ID,\n\tAge,\n\tCASE WHEN Sex_male == 1 THEN 'Male' ELSE 'Female' END AS Sex,\n\tCASE WHEN Job == 0 THEN 'Unemployed/Unskilled, Non-resident' ELSE \n\t\t(CASE WHEN Job == 1 THEN 'Unskilled-resident' ELSE\n\t\t \t(CASE WHEN Job == 2 THEN 'Skilled employee/Official' ELSE \n\t\t\t 'Management/Self-employed/Highly qualified employee/Officer' END)\n\t\t END)\n\tEND AS Job,\n\tCASE WHEN Housing_own == 1 THEN 'Own' ELSE\n\t\t(CASE WHEN Housing_rent == 1 THEN 'Rent' ELSE 'Free' END)\n\tEND AS Housing,\n\tCASE WHEN Savings_moderate == 1 THEN 'Moderate' ELSE\n\t\t(CASE WHEN Savings_no_inf == 1 THEN null ELSE\n\t\t\t(CASE WHEN Savings_quite_rich == 1 THEN 'Quite Rich' ELSE \n\t\t\t\t(CASE WHEN Savings_rich == 1 THEN 'Rich' ELSE 'Little' END)\n\t\t\t END)\n\t\t END)\n\tEND AS Saving_accounts,\n\tCASE WHEN Check_moderate == 1 THEN 'Moderate' ELSE\n\t\t(CASE WHEN Check_no_inf == 1 THEN null ELSE\n\t\t\t(CASE WHEN Check_rich == 1 THEN 'Rich' ELSE 'Little' END)\n\t\tEND)\n\tEND AS Checking_account,\n\tCredit_amount,\n\tDuration,\n\tCASE WHEN Purpose_car == 1 THEN 'Car' ELSE\n\t\t(CASE WHEN Purpose_domestic_appliances == 1 THEN 'Domestic Appliances' ELSE\n\t\t\t(CASE WHEN Purpose_education == 1 THEN 'Education' ELSE \n\t\t\t\t(CASE WHEN Purpose_furniture_equipment == 1 THEN 'Furniture/Equipment' ELSE\n\t\t\t\t\t(CASE WHEN Purpose_radio_TV == 1 THEN 'Radio/TV' ELSE\n\t\t\t\t\t\t(CASE WHEN Purpose_repairs == 1 THEN 'Repairs' ELSE 'Vacation/Others' END)\n\t\t\t\t\t END)\n\t\t\t\t END)\n\t\t\t END)\n\t\t END)\n\tEND AS Purpose,\n\tFLOAT(probability.values[1]) FROM MlModel","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"RenameColumns","stepType":"Transformation","className":"RenameColumnTransformStep","classPrettyName":"RenameColumns","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":656.7104782428212,"y":489.35793539096176}},"configuration":{"columns":[{"name":"CAST(probability.values AS `values`[1] AS FLOAT)","alias":"ProbabilityValue"},{"name":"ID","alias":"ID_Ml"},{"name":"Checking_account","alias":"CheckingAccount"},{"name":"Credit_amount","alias":"CreditAmount"},{"name":"Saving_accounts","alias":"SavingAccounts"}],"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Persist","stepType":"Transformation","className":"PersistTransformStep","classPrettyName":"Persist","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":1084.7273272726823,"y":640.8373828511114}},"configuration":{"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[{"saveMode":"Append","outputStepName":"ScoringModelAudit","tableName":"ScoringModelAudit_dangt0521","discardTableName":"","extraOptions":{"saveMode":"Append","partitionBy":"","partitions":"","partitionColumns":""}}]},{"name":"DropDuplicatedID","stepType":"Transformation","className":"DropColumnsTransformStep","classPrettyName":"DropColumns","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":884.6619806815114,"y":641.2511432588246}},"configuration":{"schema.fields":[{"name":"ID_Ml"}],"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"ScoringModelAudit","stepType":"Output","className":"ParquetOutputStep","classPrettyName":"Parquet","arity":["NullaryToNullary","NaryToNullary"],"uiConfiguration":{"position":{"x":1084.586615171738,"y":495.1795511402356}},"configuration":{"path":"/certification/students/dangt0521/","errorSink":false,"saveOptions":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[],"outputsWriter":[]},{"name":"Repartition","stepType":"Transformation","className":"RepartitionTransformStep","classPrettyName":"Repartition","arity":[],"uiConfiguration":{"position":{"x":1291.4876466295616,"y":640.9301856079647}},"configuration":{"partitions":"1","columns":"[]","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"IncomeTaxAlert","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":1527.4829871817562,"y":778.8172167593378}},"configuration":{"filterExp":"UkvCheck = 1","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"UnpaidCreditsOrFraudReports","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":1527.4829871817562,"y":915.8172167593378}},"configuration":{"filterExp":"LegalCase = 1 OR PoliceReport = 1","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"RedLevelScoring","stepType":"Transformation","className":"UnionTransformStep","classPrettyName":"Union","arity":["NaryToNary"],"uiConfiguration":{"position":{"x":1786.4093714510605,"y":779.323714875185}},"configuration":{"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"ExternalOrAuditDataFraud","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":1527.4158275784466,"y":1053.5551683756519}},"configuration":{"filterExp":"ContactAudit = 1 OR FraudSuspicion = 1","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"NoFraudulentAddress","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":1527.664535534173,"y":1190.754710287661}},"configuration":{"filterExp":"AddressFraudCheck = 0","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"YellowLevelScoring","stepType":"Transformation","className":"UnionTransformStep","classPrettyName":"Union","arity":["NaryToNary"],"uiConfiguration":{"position":{"x":1792.5435495493707,"y":1107.2537642427392}},"configuration":{"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"AddRedColumn","stepType":"Transformation","className":"AddColumnsTransformStep","classPrettyName":"AddColumns","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":2041.8795071800064,"y":779.514740317092}},"configuration":{"selectType":"COLUMNS","columns":[{"field":"RiskLevelScoring","query":"Red","type":"string"}],"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"AddYellowColumn","stepType":"Transformation","className":"AddColumnsTransformStep","classPrettyName":"AddColumns","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":2044.7903958518814,"y":1107.7282718112326}},"configuration":{"selectType":"COLUMNS","columns":[{"field":"RiskLevelScoring","query":"Yellow","type":"string"}],"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"HighCreditSizeThreshold","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":1795.4372363875868,"y":1290.0152213647664}},"configuration":{"filterExp":"CreditAmount > 4000","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"AddGreenColumn","stepType":"Transformation","className":"AddColumnsTransformStep","classPrettyName":"AddColumns","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":2048.114238340712,"y":1290.1402213647664}},"configuration":{"selectType":"COLUMNS","columns":[{"field":"RiskLevelScoring","query":"Green","type":"string"}],"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"CompleteRiskLevelScoring","stepType":"Transformation","className":"UnionTransformStep","classPrettyName":"Union","arity":["NaryToNary"],"uiConfiguration":{"position":{"x":2299.536977736628,"y":1107.6200290697989}},"configuration":{"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"FinalRepartition","stepType":"Transformation","className":"RepartitionTransformStep","classPrettyName":"Repartition","arity":[],"uiConfiguration":{"position":{"x":2745.178412406339,"y":1107.8244287846808}},"configuration":{"partitions":"1","columns":"[]","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[{"saveMode":"Append","outputStepName":"Parquet","tableName":"CreditRiskScoring_dangt0521","discardTableName":"","extraOptions":{"saveMode":"Append","partitionBy":"","partitions":"","partitionColumns":""}}]},{"name":"Parquet","stepType":"Output","className":"ParquetOutputStep","classPrettyName":"Parquet","arity":["NullaryToNullary","NaryToNullary"],"uiConfiguration":{"position":{"x":2991.641786437955,"y":1107.9738584708061}},"configuration":{"path":"/certification/students/dangt0521/","errorSink":false,"saveOptions":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[],"outputsWriter":[]},{"name":"DropColumns","stepType":"Transformation","className":"DropColumnsTransformStep","classPrettyName":"DropColumns","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":2503.2063702722426,"y":1107.7004660092916}},"configuration":{"schema.fields":[{"name":"AddressFraudCheck"},{"name":"ContactAudit"},{"name":"FraudSuspicion"},{"name":"LegalCase"},{"name":"PoliceReport"},{"name":"ProbabilityValue"},{"name":"UkvCheck"}],"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]}],"edges":[{"origin":"CreditRequestsToday","destination":"MlModel","dataType":"ValidData"},{"origin":"ExternalAuditoryData","destination":"ProcessedAndAuditoryDataJoined","dataType":"ValidData"},{"origin":"MlModel","destination":"MlFiltered","dataType":"ValidData"},{"origin":"MlFiltered","destination":"RenameColumns","dataType":"ValidData"},{"origin":"RenameColumns","destination":"ProcessedAndAuditoryDataJoined","dataType":"ValidData"},{"origin":"ProcessedAndAuditoryDataJoined","destination":"DropDuplicatedID","dataType":"ValidData"},{"origin":"DropDuplicatedID","destination":"Persist","dataType":"ValidData"},{"origin":"Persist","destination":"ScoringModelAudit","dataType":"ValidData"},{"origin":"Persist","destination":"Repartition","dataType":"ValidData"},{"origin":"Repartition","destination":"HighRiskFilter","dataType":"ValidData"},{"origin":"HighRiskFilter","destination":"IncomeTaxAlert","dataType":"DiscardedData"},{"origin":"IncomeTaxAlert","destination":"UnpaidCreditsOrFraudReports","dataType":"DiscardedData"},{"origin":"HighRiskFilter","destination":"RedLevelScoring","dataType":"ValidData"},{"origin":"IncomeTaxAlert","destination":"RedLevelScoring","dataType":"ValidData"},{"origin":"UnpaidCreditsOrFraudReports","destination":"RedLevelScoring","dataType":"ValidData"},{"origin":"UnpaidCreditsOrFraudReports","destination":"ExternalOrAuditDataFraud","dataType":"DiscardedData"},{"origin":"ExternalOrAuditDataFraud","destination":"NoFraudulentAddress","dataType":"DiscardedData"},{"origin":"ExternalOrAuditDataFraud","destination":"YellowLevelScoring","dataType":"ValidData"},{"origin":"NoFraudulentAddress","destination":"YellowLevelScoring","dataType":"ValidData"},{"origin":"RedLevelScoring","destination":"AddRedColumn","dataType":"ValidData"},{"origin":"YellowLevelScoring","destination":"AddYellowColumn","dataType":"ValidData"},{"origin":"NoFraudulentAddress","destination":"HighCreditSizeThreshold","dataType":"DiscardedData"},{"origin":"HighCreditSizeThreshold","destination":"AddGreenColumn","dataType":"ValidData"},{"origin":"AddRedColumn","destination":"CompleteRiskLevelScoring","dataType":"ValidData"},{"origin":"AddYellowColumn","destination":"CompleteRiskLevelScoring","dataType":"ValidData"},{"origin":"AddGreenColumn","destination":"CompleteRiskLevelScoring","dataType":"ValidData"},{"origin":"FinalRepartition","destination":"Parquet","dataType":"ValidData"},{"origin":"CompleteRiskLevelScoring","destination":"DropColumns","dataType":"ValidData"},{"origin":"DropColumns","destination":"FinalRepartition","dataType":"ValidData"}],"annotations":[]},"executionEngine":"Batch","uiSettings":{"position":{"x":-1158.2630844416244,"y":-561.111395567199,"k":0.7649683189285987}},"lastUpdateDate":"2020-05-27T14:49:11Z","version":0,"group":{"id":"5488b1bc-3b1e-4064-9abf-59f4087f57e1","name":"/home/certification/students/dangt0521"},"debugMode":false,"versionSparta":"2.12.0-2325718","groupId":"5488b1bc-3b1e-4064-9abf-59f4087f57e1"}